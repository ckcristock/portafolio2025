<h2 mat-dialog-title>{{ modalTitle }}</h2>

<mat-dialog-content>
  <form (ngSubmit)="onSubmit()">
    <div class="row">
      <div class="col-md-6 mb-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Equipo Local</mat-label>
          <mat-select
            [(ngModel)]="partido.home_team_id"
            name="home_team_id"
            required
            (selectionChange)="onTeamSelectionChange()"
          >
            <mat-option [value]="null" disabled
              >Selecciona un equipo</mat-option
            >
            <mat-option *ngFor="let team of allTeams" [value]="team.id">{{
              team.name
            }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-md-6 mb-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Goles Local</mat-label>
          <input
            matInput
            type="number"
            [(ngModel)]="partido.home_team_score"
            name="home_team_score"
            min="0"
            required
          />
        </mat-form-field>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6 mb-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Equipo Visitante</mat-label>
          <mat-select
            [(ngModel)]="partido.away_team_id"
            name="away_team_id"
            required
            (selectionChange)="onTeamSelectionChange()"
          >
            <mat-option [value]="null" disabled
              >Selecciona un equipo</mat-option
            >
            <mat-option *ngFor="let team of allTeams" [value]="team.id">{{
              team.name
            }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-md-6 mb-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Goles Visitante</mat-label>
          <input
            matInput
            type="number"
            [(ngModel)]="partido.away_team_score"
            name="away_team_score"
            min="0"
            required
          />
        </mat-form-field>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6 mb-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Ubicación</mat-label>
          <input
            matInput
            type="text"
            [(ngModel)]="partido.location"
            name="location"
            required
          />
        </mat-form-field>
      </div>
      <div class="col-md-6 mb-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Fecha del Partido</mat-label>
          <input
            matInput
            type="datetime-local"
            [(ngModel)]="partido.match_date"
            name="match_date"
            required
          />
        </mat-form-field>
      </div>
    </div>

    <div *ngIf="modalErrorMessage" class="alert alert-danger mt-3" role="alert">
      {{ modalErrorMessage }}
    </div>

    <mat-divider class="mb-3 mt-3"></mat-divider>
    <h3>Goles y Participación de Jugadores</h3>

    <div class="row mt-3">
      <div class="col-12 mb-3" *ngIf="partido.home_team_id">
        <h5>Jugadores del Equipo Local ({{ homeTeamName }}):</h5>
        <div *ngIf="homePlayers.length === 0" class="text-muted">
          No hay jugadores disponibles para este equipo. Asegúrate de que los
          equipos tengan jugadores asignados en la base de datos.
        </div>
        <div
          *ngFor="let player of homePlayers"
          class="mb-2 d-flex align-items-center"
        >
          <div class="col-4">
            {{ player.name }}
            <span class="text-muted">({{ player.position }})</span>
          </div>
          <div class="col-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Goles</mat-label>
              <input
                matInput
                type="number"
                [(ngModel)]="playerStats[player.id].goals"
                name="home_player_goals_{{ player.id }}"
                min="0"
              />
            </mat-form-field>
          </div>
          <div class="col-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Asistencias</mat-label>
              <input
                matInput
                type="number"
                [(ngModel)]="playerStats[player.id].assists"
                name="home_player_assists_{{ player.id }}"
                min="0"
              />
            </mat-form-field>
          </div>
          <div class="col-2 text-end">
            <mat-checkbox
              [(ngModel)]="playerStats[player.id].played_full_match"
              name="home_player_played_{{ player.id }}"
            >
              Jugó completo
            </mat-checkbox>
          </div>
        </div>
      </div>

      <div class="col-12" *ngIf="partido.away_team_id">
        <h5>Jugadores del Equipo Visitante ({{ awayTeamName }}):</h5>
        <div *ngIf="awayPlayers.length === 0" class="text-muted">
          No hay jugadores disponibles para este equipo. Asegúrate de que los
          equipos tengan jugadores asignados en la base de datos.
        </div>
        <div
          *ngFor="let player of awayPlayers"
          class="mb-2 d-flex align-items-center"
        >
          <div class="col-4">
            {{ player.name }}
            <span class="text-muted">({{ player.position }})</span>
          </div>
          <div class="col-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Goles</mat-label>
              <input
                matInput
                type="number"
                [(ngModel)]="playerStats[player.id].goals"
                name="away_player_goals_{{ player.id }}"
                min="0"
              />
            </mat-form-field>
          </div>
          <div class="col-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Asistencias</mat-label>
              <input
                matInput
                type="number"
                [(ngModel)]="playerStats[player.id].assists"
                name="away_player_assists_{{ player.id }}"
                min="0"
              />
            </mat-form-field>
          </div>
          <div class="col-2 text-end">
            <mat-checkbox
              [(ngModel)]="playerStats[player.id].played_full_match"
              name="away_player_played_{{ player.id }}"
            >
              Jugó completo
            </mat-checkbox>
          </div>
        </div>
      </div>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()">Cancelar</button>
  <button mat-raised-button color="primary" (click)="onSubmit()">
    {{ isEditMode ? "Guardar Cambios" : "Registrar Partido" }}
  </button>
</mat-dialog-actions>
